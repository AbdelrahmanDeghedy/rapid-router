{% extends 'website/base.html' %}

{% load static %}
{% load compress %}
{% load i18n %}

{% block title %}Game{% endblock %}

{% block scripts %}
{{block.super}}
  <script type="text/javascript" src="{% static 'game/js/skulpt/skulpt.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/skulpt/skulpt-stdlib.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/skulpt/codemirror.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/skulpt/python.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/skulpt/editor.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/blockly/blockly_compressed.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/blockly/blocks_compressed.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/blockly/javascript_compressed.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/blockly/python_compressed.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/blockly/msg/js/en.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/mobile-detect.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/raphael.js' %}"></script>

  <script type="text/javascript" src="{% static 'game/js/messages.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/drawing.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/animation.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/blocklyControl.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/blocklyCompiler.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/blocklyCustomBlocks.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/game.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/pathFinder.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/model.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/map.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/trafficLight.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/destination.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/van.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/node.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/coordinate.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/program.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/sound.js' %}"></script>
  <script type="text/javascript" src="{% static 'game/js/saving.js' %}"></script>

  <script>
    var PATH = {{level.path|safe}};
    var DESTINATIONS = {{level.destinations|safe}};
    var DECOR = {{decor|safe}};
    var BACKGROUND_URL = "{{background}}";
    var HOUSE_URL = "{{house}}";
    var CFC_URL = "{{cfc}}"
    var TRAFFIC_LIGHTS = {{level.traffic_lights|safe}};
    var LEVEL_ID = "{{level.id}}";
    var MODEL_SOLUTION = {{level.model_solution}};
    var LESSON = "{{lesson}}";
    var HINT = "{{hint}}";
    var BLOCKS =  [];
    {% for block in blocks %}
      BLOCKS.push("{{block.type}}");
    {% endfor %}
    var MAX_FUEL = {{level.max_fuel}};
    var DIRECT_DRIVE = "{{level.direct_drive}}" == "True";
    var NEXT_LEVEL = "{{level.next_level}}" != "None" ? "{{level.next_level.id}}" : null;
    var NEXT_EPISODE = "{{level.episode.next_episode}}" != "None" ? "{{level.episode.next_episode.id}}" : null;
    var WORKSPACE = "{{attempt.workspace}}";
    var THREADS = "{{level.threads}}";
    var LOGGED_IN_AS_STUDENT = "{{attempt}}" != "None";
    var BLOCKLY_ENABLED = "{{level.blocklyEnabled}}" == "True";
    var PYTHON_ENABLED = "{{level.pythonEnabled}}" == "True";
  </script>
  
{% endblock %}

{% block css %}
{{block.super}}
  {% compress css %}
    <link href="{% static 'game/css/game.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'game/css/game_screen.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'game/css/skulpt/codemirror.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'game/css/skulpt/solarized.css' %}" rel="stylesheet" type="text/css">
  {% endcompress %}
{% endblock %}

{% block content %}
<div id="wrapper">
  <div id="programmingConsole" class="col no-print unselectable" >
    <div id="blockly" {% if not level.blocklyEnabled%} style="visibility: hidden" {% endif %}></div>

    <div id="pythonCode" {% if not level.pythonEnabled%} style="visibility: hidden" {% endif %}>
      <h3>Python Program</h3>
        <div id="editor" style="margin-bottom:50px">
          <p>Use the Python editor below to design your program, and click run to try it out!</p>
          <textarea id="code" cols="85" rows="25"></textarea>
        </div>

        <div id="console">
          <h4 style="height:50px; line-height: 50px;">Console Output <button class="svg_button navigation_button" id="clear_console"> Clear Console</button></h4>
          <textarea disabled="" id="consoleOutput"></textarea>
        </div>

        <div id="python_help">
          <h4>Van Commands:</h4>
          <p>move_forwards(), turn_left(), turn_right(), turn_around(), wait()</p>
          <p>at_dead_end(), at_destination()</p>
          <p>at_traffic_light(c), where c is 'GREEN' or 'RED'</p>
          <p>at_red_traffic_light(), at_green_traffic_light()</p>
          <p>is_road(d), where d is 'FORWARD', 'LEFT' or 'RIGHT'</p>
          <p>is_road_forward(), is_road_left(), is_road_right()</p>
        </div>
    </div>
  </div>

  <div id="side_menu" class="no-print unselectable">
    <button class="svg_button menu_button" id="pause"></button>
    <button class="svg_button menu_button" id="play"></button>
    <button class="svg_button menu_button" id="stop"></button>
    <button class="svg_button menu_button" id="resume"></button>
    <button class="svg_button menu_button" id="step"></button>

    <button class="svg_button menu_button" id="save"></button>
    <button class="svg_button menu_button" id="load"></button>
    <button class="svg_button menu_button" id="clear_program"></button>

    <button class="svg_button menu_button" id="toggle_console"></button>
    <button class="svg_button menu_button" id="big_code_mode"></button>

    <button class="svg_button menu_button" id="help"></button>
    <button class="svg_button menu_button" id="muted"></button>
    <button class="svg_button menu_button" id="unmuted"></button>
    <button class="svg_button menu_button" id="quit"></button>
  </div>

  <div class="no-print unselectable">
    <button class="navigation_button" id="show">
      <image src="/static/game/image/icons/show.svg"/>
      <span>Show</span>
    </button>

    <button class="navigation_button" id="hide">
      <image src="/static/game/image/icons/hide.svg"/>
      <span>Hide</span>
    </button>
  </div>

  <div id="direct_drive" class="unselectable">
    <button class="svg_button direct_drive_button" id="moveForward" {% if not level.direct_drive %} style="visibility: hidden" {% endif %}></button>
    <button class="svg_button direct_drive_button" id="turnLeft" {% if not level.direct_drive %} style="visibility: hidden" {% endif %}></button>
    <button class="svg_button direct_drive_button" id="go" {% if not level.direct_drive %} style="visibility: hidden" {% endif %}></button>
    <button class="svg_button direct_drive_button" id="turnRight" {% if not level.direct_drive %} style="visibility: hidden" {% endif %}></button>
  </div>
  
  <div id="fuelGauge" class="no-print unselectable">
    <img src="/static/game/image/fuelGauge.svg"/>
    <div id="fuelGaugePointer">
      <img src="/static/game/image/fuelGaugePointer.svg"/>
    </div>
  </div>

  <div id="paper" class="col" style="background-color:{{level.theme.background}}"></div>
  
  <div id="consoleSlider" class="no-print"></div>
</div>

<div id="myModal" class="ocargo-modal reveal-modal no-print" data-reveal>
  <h2 id="myModal-title" class="ocargo-modal-title"></h2>
  <p id="myModal-lead" class="ocargo-modal-lead"></p>
  <p id="myModal-mainText" class="ocargo-modal-mainText"></p>
  <a class="close-reveal-modal" id="close-modal">&#215;</a>
</div>

<div id="loadModal" class="ocargo-modal reveal-modal no-print" data-reveal>
  <h2 class="title"><img class="save_load_image" src='/static/game/image/menu_button_load.svg'/>Load</h2>
  <p>Here you can load a previously saved program.</p>
  <div style="width:auto">
    <div class="scrolling-table-wrapper">
      <div class="scrolling-table">
        <table id="loadWorkspaceTable"></table>
      </div>
    </div>
    <div>
      <button class="navigation_button" id="deleteWorkspace">
        <image src="/static/game/image/icons/clear.svg"/>
        <span>Delete</span>
      </button>

      <button class="navigation_button" id="loadWorkspace">
        <image src="/static/game/image/icons/load.svg"/>
        <span>Load</span>
      </button>
    </div>
  </div>
  <a class="close-reveal-modal" id="close-load-modal">&#215;</a>
</div>

<div id="saveModal" class="ocargo-modal reveal-modal no-print" data-reveal>
  <h2 class="title"><img class="save_load_image" src='/static/game/image/menu_button_save.svg'/>Save</h2>
  <p>Here you can save your program.</p>
  <div>
    <div class="scrolling-table-wrapper">
      <div class="scrolling-table">
        <table id="saveWorkspaceTable"></table>
      </div>
    </div>
    <div>
      <input id="workspaceNameInput"/>

      <button class="navigation_button" id="saveWorkspace">
        <image src="/static/game/image/icons/save.svg"/>
        <span>Save</span>
      </button>
    </div>
  </div>
  <a class="close-reveal-modal" id="close-load-modal">&#215;</a>
</div>

<xml id="toolbox" style="display: none">
  <category name="+">
    {% for block in blocks %}
      <block type="{{ block.type }}"></block>
    {% endfor %}
  </category>
</xml>

{% endblock %}
