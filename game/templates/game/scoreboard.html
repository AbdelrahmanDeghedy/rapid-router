{% extends 'game/base.html' %}

{% load static %}
{% load compress %}

{% block title %}Code for Life - Rapid Router - Scoreboard{% endblock %}

{% block scripts %}
  <script src="{% static 'game/js/jquery.dataTables.js' %}"></script>
  <script src="{% static 'game/js/dataTables.fixedColumns.js' %}"></script>
  <script src="{% static 'game/js/jquery.tablesorter.js' %}"></script>
  <script src="{% static 'game/js/widget-scroller.js' %}"></script>
  <script src="{% static 'game/js/pqselect.dev.js' %}"></script>
  <script src="{% static 'game/js/jquery.outerhtml.js' %}"></script>
  <script src="{% static 'game/js/jquery.ui.multiprogressbar.js' %}"></script>
  <script>
    $(document).ready(function() {
        // Initialise progress values for each progress bar
        {# Only initialise progress bars if the column exists #}
        {% if 'Progress' in headers %}
          {% for student in student_data %}
              var id = {{ student.0.id }}
              var started = {{ student.4.0 }}
              var attempted = {{ student.4.1 }}
              var finished = {{ student.4.2 }}
              $('#progressbar' + id).multiprogressbar({
                  parts: [{value: started, barClass: 'started'},
                          {value: attempted, barClass: 'attempted'},
                          {value: finished, barClass: 'finished'}],
              });
          {% endfor %}
        {% endif %}

        var table = $('#scoreboardTable').DataTable({
            scrollY:        ($(window).height() - 100) + "px",
            scrollX:        true,
            scrollCollapse: true,
            paging:         false,
            deferRender:    true,

        });

        new $.fn.dataTable.FixedColumns( table, {
            leftColumns: 2
        } );
        $(".tableWrapper").css('visibility', 'visible');
        document.getElementById("tableWrapper").scrollIntoView();
    });
  </script>
{{block.super}}
{% endblock %}

{% block css %}
{{block.super}}
  <link href="{% static 'game/css/scoreboard.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'game/css/pqselect.dev.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'game/css/pqselect.multiselect.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'game/css/theme.blue.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'game/css/jquery.ui.multiprogressbar.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'game/css/jquery.dataTables.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'game/css/dataTables.fixedColumns.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'game/css/dataTables.jqueryui.css' %}" rel="stylesheet" type="text/css">
{% endblock %}

{% block nav_ocargo_scoreboard %}
<b><a href="{% url 'game.views.scoreboard.scoreboard' %}">Scoreboard</a></b>
{% endblock nav_ocargo_scoreboard %}

{% block content %}
<h1>Scoreboard</h1><br>
<div class='span_3_of_3'>
  <div class='login-card'>
    <div id="form" class="form">
    <form action="" method="post" id="scoreboardForm">
      {% csrf_token %}
      <div class='section group'>
        <div class='col span_1_of_3_strict'>
          <div class='section group'>
            <div class='col span_1_of_3'>
              Classes:
            </div>
            <div class='col span_2_of_3'>
              {{form.classes.errors}}
              {{form.classes}}
            </div>
          </div>
        </div>
        <div class='col span_1_of_3_strict'>
          <div class='section group'>
            <div class='col span_1_of_3'>
              Levels:
            </div>
            <div class='col span_2_of_3'>
              {{form.levels.errors}}
              {{form.levels}}
            </div>
          </div>
        </div>
        <div class='col span_1_of_3_strict'>
          <button class='col span_1_of_2 btn btn-primary' type="submit" name="view">View</button>
          <button class='col span_1_of_2 btn btn-primary' type="submit" name="export">Export</button>
        </div>
      </div>
    </form>
    </div>
  </div>
</div>
<br>
<div class="mainBody">
  <div class="tableWrapper" id="tableWrapper">
    {% if student_data %}
    <table id="scoreboardTable" class="display cell-border wide">
    <thead>
      <tr>
        {% for header in headers %}
          <th> {{header}} </th>
        {% endfor %}
      </tr>
      </thead>
      {% for student in student_data %}
      <tr>
          <td> {{student.5}} </td>
          <td> {{student.0.user.user.first_name}} </td>
          <td> {{student.1}} </td>
          <td> {{student.2}}
          {% if headers.2 == 'Score' %}
            <td> {{student.3}} </td>
            <td> {{student.4}} </td>
          {% else %}
            <td> <div class="MultiProgressBarDiv" id="progressbar{{ student.0.id }}"></div> </td>
            {% for levelScore in student.3 %}
              {# Levels that students have not started will be marked with grey colour #}
              <td > {{levelScore}} </td>
            {% endfor %}
          {% endif %}
        </tr>
      {% endfor %}
    </table>
    {% endif %}
  </div>
</div>
{% endblock %}
